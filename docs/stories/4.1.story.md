# Story 4.1: React Application Setup

## Status

Ready for dev

## Story

**As a** frontend developer,
**I want** to establish the React application structure with routing and state management,
**so that** we can build a scalable dashboard application.

## Acceptance Criteria

1. React app with TypeScript configured using Vite for fast development builds
2. React Router implements routes for /login, /dashboard, /prices, /analytics, /settings
3. Zustand or Redux Toolkit configured for global state management
4. Shadcn/ui components library integrated with Tailwind CSS configuration
5. Axios configured with interceptors for API authentication and error handling
6. Responsive layout shell with mobile-first breakpoints (320px, 768px, 1024px)

## Tasks / Subtasks

- [ ] **Task 1: Verify and Enhance Vite Configuration** (AC: 1)
  - [ ] Review existing vite.config.ts setup
  - [ ] Add development server proxy for API calls
  - [ ] Configure build optimization settings
  - [ ] Set up environment variable handling (.env files)
  - [ ] Add PWA support configuration
  - [ ] Configure source maps for development

- [ ] **Task 2: Set Up React Router** (AC: 2)
  - [ ] Install react-router-dom if not present
  - [ ] Create src/router/index.tsx with route configuration
  - [ ] Implement route components for each main section
  - [ ] Create ProtectedRoute component for auth-required routes
  - [ ] Set up lazy loading for route components
  - [ ] Add 404 Not Found route handling

- [ ] **Task 3: Configure Zustand State Management** (AC: 3)
  - [ ] Review existing Zustand setup (v5.0.7 installed)
  - [ ] Create src/stores/authStore.ts for authentication state
  - [ ] Create src/stores/pricingStore.ts for pricing data
  - [ ] Create src/stores/uiStore.ts for UI state
  - [ ] Create src/stores/alertStore.ts for notifications
  - [ ] Implement devtools integration for debugging
  - [ ] Add persistence for selected store slices

- [ ] **Task 4: Integrate Shadcn/ui Components** (AC: 4)
  - [ ] Initialize shadcn/ui with TypeScript configuration
  - [ ] Configure components.json for shadcn/ui
  - [ ] Install core UI components (Button, Card, Dialog, Form, Table)
  - [ ] Set up component aliases in tsconfig.json
  - [ ] Create src/components/ui/ directory structure
  - [ ] Configure dark mode support with theme provider

- [ ] **Task 5: Enhance Tailwind CSS Configuration** (AC: 4, 6)
  - [ ] Review existing tailwind.config.js
  - [ ] Add custom color palette for brand colors
  - [ ] Configure responsive breakpoints (320px, 768px, 1024px)
  - [ ] Add custom utility classes for common patterns
  - [ ] Set up CSS variables for theming
  - [ ] Configure animation utilities

- [ ] **Task 6: Set Up Axios API Client** (AC: 5)
  - [ ] Create src/services/api/client.ts with Axios instance
  - [ ] Implement request interceptor for JWT token attachment
  - [ ] Implement response interceptor for token refresh
  - [ ] Add error handling interceptor with retry logic
  - [ ] Create API service classes for each domain
  - [ ] Add request/response logging for development

- [ ] **Task 7: Create Responsive Layout Shell** (AC: 6)
  - [ ] Create src/components/layout/AppLayout.tsx
  - [ ] Implement responsive sidebar for desktop
  - [ ] Implement bottom navigation for mobile
  - [ ] Create header with user menu and notifications
  - [ ] Add breadcrumb navigation component
  - [ ] Implement loading states and skeletons

- [ ] **Task 8: Set Up Authentication Flow** (AC: 2, 5)
  - [ ] Create src/pages/auth/Login.tsx page
  - [ ] Create src/pages/auth/Register.tsx page
  - [ ] Implement JWT token storage in localStorage
  - [ ] Add auto-refresh logic before token expiration
  - [ ] Create useAuth hook for auth operations
  - [ ] Implement logout functionality

- [ ] **Task 9: Create Base Page Components** (AC: 2)
  - [ ] Create src/pages/Dashboard.tsx
  - [ ] Create src/pages/Prices.tsx
  - [ ] Create src/pages/Analytics.tsx
  - [ ] Create src/pages/Settings.tsx
  - [ ] Add loading and error boundaries
  - [ ] Implement page-level layouts

- [ ] **Task 10: Configure Development Tools** (AC: 1)
  - [ ] Set up React DevTools integration
  - [ ] Configure ESLint with React rules
  - [ ] Set up Prettier for code formatting
  - [ ] Add pre-commit hooks with Husky
  - [ ] Configure VS Code workspace settings
  - [ ] Add debugging configuration

- [ ] **Task 11: Implement Error Handling** (AC: 6)
  - [ ] Create ErrorBoundary component
  - [ ] Set up Sentry error tracking (already initialized)
  - [ ] Create error notification system
  - [ ] Add network error recovery
  - [ ] Implement fallback UI components
  - [ ] Add error logging service

- [ ] **Task 12: Write Unit Tests** (AC: All)
  - [ ] Test route configuration
  - [ ] Test protected route behavior
  - [ ] Test store actions and state updates
  - [ ] Test API interceptors
  - [ ] Test responsive layout behavior
  - [ ] Test error boundary functionality

- [ ] **Task 13: Write Integration Tests** (AC: 2, 3, 5)
  - [ ] Test authentication flow
  - [ ] Test API client with mock server
  - [ ] Test state persistence
  - [ ] Test route navigation
  - [ ] Test store interactions

## Dev Notes

### Current Project State

[Source: apps/web/package.json, apps/web/src/main.tsx]

The React application already has basic setup:

- **React**: 19.1.1 (latest)
- **TypeScript**: 5.8.3
- **Vite**: 7.1.2
- **Zustand**: 5.0.7 (installed)
- **Axios**: 1.11.0 (installed)
- **Tailwind CSS**: 3.4.17 (configured)
- **Sentry**: Configured for error tracking
- **Vitest**: 3.2.4 (for testing)

### Vite Configuration

[Source: apps/web/vite.config.ts]

Existing configuration:

```typescript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import { sentryVitePlugin } from "@sentry/vite-plugin";

export default defineConfig({
  plugins: [
    react(),
    sentryVitePlugin({...}),
  ],
  resolve: {
    alias: {
      "@": path.resolve(__dirname, "./src"),
    },
  },
  build: {
    sourcemap: true,
  },
});
```

Need to add:

- Development server proxy configuration
- Environment variable handling
- Build optimization settings

### State Management Structure

[Source: docs/architecture/frontend-architecture.md]

Zustand store structure to implement:

```typescript
interface AppState {
  // User slice
  user: {
    profile: User | null;
    station: Station | null;
    preferences: UserPreferences;
  };

  // Pricing slice
  pricing: {
    currentPrices: Record<FuelType, number>;
    competitors: Station[];
    history: PriceChange[];
    lastUpdated: string;
  };

  // UI slice
  ui: {
    sidebarOpen: boolean;
    activeFilters: FilterState;
    loading: Set<string>;
    errors: Record<string, Error>;
  };

  // Alerts slice
  alerts: {
    list: Alert[];
    unreadCount: number;
  };
}
```

### Route Structure

[Source: docs/architecture/frontend-architecture.md]

Routes to implement:

```
/                    # Redirect to /dashboard
/login              # Public route
/register           # Public route
/dashboard          # Protected route - main dashboard
/prices             # Protected route - price management
  /prices/current   # Current prices view
  /prices/history   # Historical trends
  /prices/compare   # Competitor comparison
/analytics          # Protected route - analytics dashboard
/alerts             # Protected route - alert management
/settings           # Protected route - user settings
```

Protected Route Pattern:

```typescript
export const ProtectedRoute = () => {
  const { isAuthenticated, isLoading } = useAuthStore();

  if (isLoading) return <LoadingScreen />;
  if (!isAuthenticated) return <Navigate to="/login" replace />;

  return <Outlet />;
};
```

### API Client Configuration

[Source: docs/architecture/frontend-architecture.md]

API client setup pattern:

```typescript
class ApiClient {
  private client: AxiosInstance;

  constructor() {
    this.client = axios.create({
      baseURL: import.meta.env.VITE_API_URL || "http://localhost:8000/api/v1",
      headers: {
        "Content-Type": "application/json",
      },
    });

    // Request interceptor for auth
    this.client.interceptors.request.use((config) => {
      const token = useAuthStore.getState().token;
      if (token) {
        config.headers.Authorization = `Bearer ${token}`;
      }
      return config;
    });

    // Response interceptor for token refresh
    this.client.interceptors.response.use(
      (response) => response,
      async (error) => {
        if (error.response?.status === 401) {
          // Handle token refresh
        }
        return Promise.reject(error);
      },
    );
  }
}
```

### Shadcn/ui Integration

[Source: docs/architecture/tech-stack.md]

Components to install:

- Button, Card, Dialog, Form - Core UI elements
- Table, DataTable - For price displays
- Toast, Alert - For notifications
- Skeleton - For loading states
- Sheet - For mobile navigation
- Tabs - For section navigation

Configuration file (components.json):

```json
{
  "$schema": "https://ui.shadcn.com/schema.json",
  "style": "default",
  "rsc": false,
  "tsx": true,
  "tailwind": {
    "config": "tailwind.config.js",
    "css": "src/styles/globals.css",
    "baseColor": "slate",
    "cssVariables": true
  },
  "aliases": {
    "components": "@/components",
    "utils": "@/lib/utils"
  }
}
```

### Responsive Breakpoints

[Source: AC 6]

Tailwind breakpoints to configure:

```javascript
// tailwind.config.js
module.exports = {
  theme: {
    screens: {
      xs: "320px", // Mobile
      sm: "640px", // Large mobile
      md: "768px", // Tablet
      lg: "1024px", // Desktop
      xl: "1280px", // Large desktop
      "2xl": "1536px", // Extra large
    },
  },
};
```

### File Structure

[Source: docs/architecture/unified-project-structure.md]

Directory structure to create/enhance:

```
apps/web/src/
├── components/
│   ├── ui/              # Shadcn/ui components
│   ├── layout/          # Layout components
│   │   ├── AppLayout.tsx
│   │   ├── Sidebar.tsx
│   │   ├── Header.tsx
│   │   └── MobileNav.tsx
│   └── common/          # Shared components
├── pages/
│   ├── auth/
│   │   ├── Login.tsx
│   │   └── Register.tsx
│   ├── Dashboard.tsx
│   ├── Prices.tsx
│   ├── Analytics.tsx
│   └── Settings.tsx
├── router/
│   └── index.tsx        # Route configuration
├── stores/
│   ├── authStore.ts
│   ├── pricingStore.ts
│   ├── uiStore.ts
│   └── alertStore.ts
├── services/
│   ├── api/
│   │   ├── client.ts
│   │   ├── auth.service.ts
│   │   ├── pricing.service.ts
│   │   └── analytics.service.ts
├── hooks/
│   ├── useAuth.ts
│   ├── useApi.ts
│   └── useResponsive.ts
├── styles/
│   └── globals.css      # Tailwind imports
└── utils/
    └── constants.ts     # App constants
```

### Environment Variables

Create .env files:

```env
# .env.development
VITE_API_URL=http://localhost:8000/api/v1
VITE_APP_NAME=FuelIntel
VITE_SENTRY_DSN=
VITE_ENABLE_DEVTOOLS=true

# .env.production
VITE_API_URL=https://api.fuelintel.mx/api/v1
VITE_APP_NAME=FuelIntel
VITE_SENTRY_DSN=your-sentry-dsn
VITE_ENABLE_DEVTOOLS=false
```

### Type Sharing

[Source: docs/architecture/coding-standards.md]

Import types from packages/shared:

```typescript
// Don't define types locally
import { User, Station, PriceChange, FuelType } from "@fuelintel/shared";
```

### Testing Requirements

[Source: docs/architecture/testing-strategy.md]

Test structure:

```
apps/web/tests/
├── unit/
│   ├── components/   # Component tests
│   ├── stores/       # Store tests
│   └── hooks/        # Hook tests
├── integration/
│   └── services/     # API service tests
└── e2e/
    └── flows/        # User flow tests
```

## Testing

### Testing Standards

[Source: docs/architecture/testing-strategy.md]

- **Test Framework**: Vitest 3.2.4
- **Testing Library**: @testing-library/react 16.3.0
- **Test Location**: apps/web/tests/
- **Coverage Target**: 80% for components and stores
- **Mock Strategy**: Mock API calls, use MSW for integration tests

### Specific Test Cases

1. Test route navigation and protection
2. Test authentication flow (login/logout)
3. Test token refresh mechanism
4. Test responsive layout at breakpoints
5. Test store state updates
6. Test API error handling
7. Test loading states
8. Test error boundaries
9. Test theme switching
10. Test form validation

## Change Log

| Date       | Version | Description            | Author      |
| ---------- | ------- | ---------------------- | ----------- |
| 2025-08-30 | 1.0     | Initial story creation | BMad Master |

## Dev Agent Record

### Agent Model Used

(To be filled by dev agent)

### Debug Log References

(To be filled by dev agent)

### Completion Notes List

(To be filled by dev agent)

### File List

(To be filled by dev agent)

## QA Results

(To be filled by QA agent)
